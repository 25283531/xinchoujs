# 薪酬管理系统技术规格说明

## 一、系统架构

* **客户端**：.NET/WPF或Electron等技术实现，响应式现代扁平风格（vflat）界面。
* **本地数据库**：SQLite。
* **安装包**：EXE/MSI，一键式安装，内置自动更新组件。
* **备份恢复**：本地文件方式，一键导出/导入数据库文件。

## 二、核心模块说明

### 2.1 业务服务层

#### payrollService - 工资计算核心逻辑
- 负责薪酬计算的核心算法
- 处理薪酬项与薪酬组的计算逻辑
- 实现个税与社保的计算
- 处理考勤异常与扣款规则

#### importService - 数据导入服务
- 处理员工数据导入
- 处理考勤数据导入
- 处理奖惩数据导入
- 提供字段映射功能

#### exportService - 报表导出服务
- 生成Excel格式报表
- 生成PDF格式报表
- 支持按部门、个人及总表导出
- 支持自定义模板设计与保存

#### socialInsuranceService - 社保组管理
- 管理社保组配置
- 处理养老、医疗、失业等项目设置
- 管理个人与公司缴纳比例

#### taxService - 个税速算管理

**实现细节:**
- 该服务负责根据员工的应纳税所得额计算个税。
- 支持配置和管理不同年度或地区的个税税率表。
- 计算时考虑起征点、专项附加扣除、社保、公积金等因素。

**税率表结构:**
- 税率表数据存储在 `TaxSetting` 表中。
- `formula` 字段（JSON格式）包含税率分级信息，例如：
  ```json
  {
    "threshold": 5000, // 起征点
    "deductions": [], // 专项附加扣除列表
    "rates": [
      { "level": 1, "upper": 3000, "rate": 0.03, "quick_deduction": 0 },
      { "level": 2, "upper": 12000, "rate": 0.10, "quick_deduction": 210 },
      // ... 更多税率分级
    ]
  }
  ```
- 系统应能解析此JSON结构，并根据应纳税所得额查找对应的税率和速算扣除数。

**计算流程:**
1.  获取员工的税前工资总额。
2.  减去社保、公积金个人缴纳部分。
3.  减去当前生效的个税起征点。
4.  减去员工申报的专项附加扣除总额。
5.  得到应纳税所得额。
6.  根据应纳税所得额，查找 `TaxSetting` 表中当前生效税率方案的 `formula` 字段。
7.  遍历 `rates` 数组，找到应纳税所得额所属的税率分级。
8.  应用公式：个税 = 应纳税所得额 * 税率 - 速算扣除数。
9.  将计算结果作为个税扣除项返回。

### 2.2 数据层

- 采用SQLite本地数据库
- 通过轻量ORM或原生访问接口实现CRUD操作
- 支持数据备份与恢复

### 2.3 UI层

- 采用现代扁平风格（vflat）
- 响应式布局，适配常见分辨率
- 侧边栏+顶部工具条导航
- 卡片式布局看板

## 三、性能与安全

- 性能：5000人规模下，单次计算≤30秒
- 安全：本地存储，无网络传输；数据库文件可设置本地文件权限
- 易用性：模板、向导、示例提示
- 可维护性：模块化设计，配置文件驱动比例与公式

## 四、部署与运维

- 安装包：EXE/MSI，一键式安装
- 自动更新：内置检测与升级功能
- 备份恢复：SQLite数据库文件一键导出/导入
- 日志：本地日志文件，记录关键操作与错误

## 五、数据字典

详见 `data-dictionary.md` 文档。

## 六、API说明

系统为单机版应用，无外部API接口。内部模块间通过服务调用进行交互。